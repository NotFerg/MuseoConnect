<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>MuseoConnect - Games</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="images/MuseoDeLaSalle.png" type="image/jpeg" rel="icon">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <style>
    .quiz-card {
      background-color: #f8f9fa;
      border-radius: 15px;
      box-shadow: 10px 10px 10px rgba(45, 192, 16, 0.13);
      padding: 30px;
      /* Increase padding for a larger card */
      border: 2px solid #28a745;
      /* Set border color to success color */
    }

    .quiz-title {
      font-size: 40px;
      /* Increase font size for the title */
      font-weight: bold;
      color: #000000;
      margin-bottom: 30px;
      /* Increase margin for spacing */
      text-align: center;
    }

    .quiz-question {
      font-size: 24px;
      /* Increase font size for the question */
      color: #495057;
      margin-bottom: 20px;
      /* Increase margin for spacing */
    }

    .quiz-options {
      list-style-type: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      margin: 0;
    }

    .quiz-options li {
      margin-bottom: 15px;
      /* Increase margin between options */
    }

    .quiz-options label {
      display: inline-block;
      cursor: pointer;
      border: 2px solid #28a745;
      background-color: #fff;
      color: #000000;
      padding: 20px;
      /* Increase padding for larger buttons */
      border-radius: 8px;
      /* Increase border radius for rounded corners */
      transition: background-color 0.3s ease, color 0.3s ease;
      width: 100%;
      text-align: left;
      /* Align text to the left */
      font-size: 18px;
      /* Increase font size for the options */
    }

    .quiz-options input[type="radio"] {
      display: none;
    }

    .quiz-options input[type="radio"]:checked+label {
      background-color: #0056b3;
      color: #fff;
    }

    .quiz-btn {
      margin-top: 30px;
      /* Increase margin for spacing */
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 20px;
      /* Increase padding for a larger button */
      font-size: 20px;
      /* Increase font size for the button */
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .quiz-btn:hover {
      background-color: #218838;
    }

    .quiz-options label:hover {
      background-color: #28a745;
      color: #fff;
    }

    .quiz-options input[type="radio"]:checked+label {
      background-color: #28a745;
      color: #fff;
    }

    .quiz-progress {
      font-size: 18px;
      text-align: center;
      margin-top: 15px;
      color: #28a745;
      /* Change color to your preference */
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-default navbar-trans navbar-expand-lg fixed-top">
    <div class="container">
      <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarDefault"
        aria-controls="navbarDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a class="navbar-brand text-brand" href="/loggedInindex">Museo<span class="color-b">Connect</span></a>

      <div class="navbar-collapse collapse justify-content-center" id="navbarDefault">
        <ul class="navbar-nav">

          <li class="nav-item">
            <a class="nav-link" href="/loggedInindex">Home</a>
          </li>

          <li class="nav-item">
            <a class="nav-link " href="/loggedInaboutUs">About us</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/loggedIndonation">Donation</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/loggedInartifacts">Artifacts</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/loggedInvirtualTour">Virtual Tour</a>
          </li>

          <li class="nav-item">
            <a class="nav-link active" href="/loggedIngames">Games</a>
          </li>

          <li class="nav-item">
            <a class="nav-link " href="/loggedInreservation">Reservation</a>
          </li>

          <li class="nav-item">
            <a class="nav-link " href="/loggedInevaluation">Evaluation</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">Account</a>
            <div class="dropdown-menu">
              <a class="dropdown-item " href="/loggedInaccountInformation">Account Information</a>
              <a class="dropdown-item " href="/logout">Log Out</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav><!-- End Header/Navbar -->
  <br><br><br><br><br><br><br><br><br>
  
  <div id="quiz-container" class="quiz-card">
    <p id="user-score">User Score: <%= user.score %></p>
    <% quizQuestions.forEach((question, index) => { %>
      <div class="quiz-question" data-question-index="<%= index %>" style="display: <%= index === 0 ? 'block' : 'none' %>;">
        <h3 class="quiz-title"><%= question.question %></h3>
        <% if (question.type === 'multiple-choice') { %>
          <ul class="quiz-options">
            <% question.options.forEach((option, optionIndex) => { %>
              <li>
                <input type="radio" id="option-<%= index %>-<%= optionIndex %>" name="question_<%= index %>" value="<%= option.trim() %>">
                <label for="option-<%= index %>-<%= optionIndex %>"><%= option.trim() %></label>
              </li>
            <% }); %>
          </ul>
          <button class="quiz-btn" onclick="submitAnswer(event, <%= index %>, '<%= question.correctAnswer %>')">Submit</button>
        <% } else { %>
          <input type="text" id="input-answer-<%= index %>" class="form-control" placeholder="Your answer">
          <button class="quiz-btn" onclick="submitAnswer(event, <%= index %>, '<%= question.correctAnswer %>')">Submit</button>
        <% } %>
        <p id="result-message-<%= index %>" class="quiz-result-message"></p>
      </div>
    <% }); %>
    <button id="next-question-btn" class="quiz-btn" onclick="showNextQuestion(event)" style="display: none;">Next Question</button>
  </div>
  
  
  

  </main>
  <br><br><br><br><br><br><br><br><br>


  <!-- Footer -->
  <footer>

  </footer><!-- End  Footer -->


  <div id="preloader"></div>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <script src="/js/index.js"></script>

  <script>
  let currentQuestionIndex = 0;
  let userScore = parseInt("<%= user.score %>", 10);
  let totalQuestions = <%= quizQuestions.length %>;


  
  function submitAnswer(event, questionIndex, correctAnswer) {
    event.preventDefault(); // Prevent the default form submission

    let userAnswer;
    // If all questions are multiple-choice or text, you can check the type of input present
    if (document.querySelector(`input[name="question_${questionIndex}"]:checked`)) {
      const selectedOption = document.querySelector(`input[name="question_${questionIndex}"]:checked`);
      userAnswer = selectedOption ? selectedOption.value : '';
    } else {
      const inputElement = document.getElementById(`input-answer-${questionIndex}`);
      userAnswer = inputElement ? inputElement.value : '';
    }

    if (!userAnswer.trim()) {
      alert('Please select or enter an answer.');
      return;
    }

    const resultMessageElement = document.getElementById(`result-message-${questionIndex}`);
    if (resultMessageElement) {
      if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
        userScore++;
        resultMessageElement.innerText = "Correct!";
      } else {
        resultMessageElement.innerText = "Incorrect!";
      }
      document.getElementById('user-score').innerText = `User Score: ${userScore}`;
    }

    // Show the next question or end the quiz
    if (currentQuestionIndex < totalQuestions - 1) {
      document.getElementById('next-question-btn').style.display = 'block';
    } else {
      // Last question answered, update the score
      updateScore();
    }
  }
   
  function showNextQuestion(event) {
    event.preventDefault(); // Prevent the default form submission

    // Hide the current question
    const currentQuestionDiv = document.querySelector(`.quiz-question[data-question-index="${currentQuestionIndex}"]`);
    currentQuestionDiv.style.display = 'none';

    // Increment the question index
    currentQuestionIndex++;

    // Check if there are more questions
    if (currentQuestionIndex < totalQuestions) {
      // Show the next question
      const nextQuestionDiv = document.querySelector(`.quiz-question[data-question-index="${currentQuestionIndex}"]`);
      nextQuestionDiv.style.display = 'block';
      document.getElementById('next-question-btn').style.display = 'none';
    } else {
      // End of the quiz
      alert("End of the quiz!");
      updateScore();
    }
  }
  
  
  function updateScore() {
    fetch(`/loggedIn/admin/users/<%= user._id %>/score`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ score: userScore }),
    })
    .then((response) => {
      if (response.ok) {
        alert(`Your final score is: ${userScore}`);
        window.location.href = "/loggedIngames";
      }
    })
    .catch((error) => {
      console.error('Error updating score:', error);
    });
  }
  
    // Function to reset the inactivity timer
    let inactivityTimeout;
    function resetInactivityTimeout() {
      clearTimeout(inactivityTimeout);
      inactivityTimeout = setTimeout(() => {
        fetch("/reset-inactivity").then((response) => {
          if (response.ok) {
            window.location.href = "/logout";
          }
        });
      }, 300000); // 5 minutes
    }
  
    // Listen for user interactions
    window.addEventListener("mousemove", resetInactivityTimeout);
    window.addEventListener("keydown", resetInactivityTimeout);
    resetInactivityTimeout(); // Initial reset
  
    // Initially show the first question
    document.querySelector('.quiz-question[data-question-index="0"]').style.display = 'block';
  </script>
  


</body>

</html>